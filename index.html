<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>J&#39;s blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="J&#39;s blog">
<meta property="og:url" content="http://jiajie999.github.io/index.html">
<meta property="og:site_name" content="J&#39;s blog">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Jie.Jia">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="J&#39;s blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">J&#39;s blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://jiajie999.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-hello-world" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/08/13/hello-world/" class="article-date">
  <time datetime="2020-08-13T07:49:40.685Z" itemprop="datePublished">2020-08-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/08/13/hello-world/">Hello World</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Welcome to <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a target="_blank" rel="noopener" href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a target="_blank" rel="noopener" href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a target="_blank" rel="noopener" href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://jiajie999.github.io/2020/08/13/hello-world/" data-id="ckdsi8gjw000dll9k167zdse6" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-2015-06-16-cmd-notes" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/06/16/2015-06-16-cmd-notes/" class="article-date">
  <time datetime="2015-06-16T14:06:53.000Z" itemprop="datePublished">2015-06-16</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/06/16/2015-06-16-cmd-notes/">The Art of Command Line[转]</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><a target="_blank" rel="noopener" href="https://github.com/jlevy/the-art-of-command-line/blob/master/README.md">Origin</a></p>
<h1 id="The-Art-of-Command-Line"><a href="#The-Art-of-Command-Line" class="headerlink" title="The Art of Command Line"></a>The Art of Command Line</h1><ul>
<li><a href="#basics">Basics</a></li>
<li><a href="#everyday-use">Everyday use</a></li>
<li><a href="#processing-files-and-data">Processing files and data</a></li>
<li><a href="#system-debugging">System debugging</a></li>
<li><a href="#one-liners">One-liners</a></li>
<li><a href="#obscure-but-useful">Obscure but useful</a></li>
<li><a href="#more-resources">More resources</a></li>
<li><a href="#disclaimer">Disclaimer</a></li>
</ul>
<p>Fluency on the command line is a skill now often neglected or considered archaic, but it improves your flexibility and productivity as an engineer in both obvious and subtle ways. This is a selection of notes and tips on using the command-line that I’ve found useful when working on Linux. Some tips are elementary, and some are fairly specific, sophisticated, or obscure. This page is not long, but if you can use and recall all the items here, you know a lot.</p>
<p>Much of this<br><a target="_blank" rel="noopener" href="http://www.quora.com/What-are-some-lesser-known-but-useful-Unix-commands">originally</a><br><a target="_blank" rel="noopener" href="http://www.quora.com/What-are-the-most-useful-Swiss-army-knife-one-liners-on-Unix">appeared</a><br>on <a target="_blank" rel="noopener" href="http://www.quora.com/What-are-some-time-saving-tips-that-every-Linux-user-should-know">Quora</a>,<br>but given the interest there, it seems it’s worth using Github, where people more talented than I can readily suggest improvements. If you see an error or something that could be better, please submit an issue or PR!</p>
<p>Scope:</p>
<ul>
<li>The goals are breadth and brevity. Every tip is essential in some situation or significantly saves time over alternatives.</li>
<li>This is written for Linux. Many but not all items apply equally to MacOS (or even Cygwin).</li>
<li>The focus is on interactive Bash, though many tips apply to other shells and to general Bash scripting.</li>
<li>Descriptions are intentionally minimal, with the expectation you’ll use <code>man</code>, <code>apt-get</code>/<code>yum</code> to install, and Google for more background.</li>
</ul>
<h2 id="Basics"><a href="#Basics" class="headerlink" title="Basics"></a>Basics</h2><ul>
<li><p>Learn basic Bash. Actually, type <code>man bash</code> and at least skim the whole thing; it’s pretty easy to follow and not that long. Alternate shells can be nice, but bash is powerful and always available (learning <em>only</em> zsh, fish, etc., while tempting on your own laptop, restricts you in many situations, such as using existing servers).</p>
</li>
<li><p>Learn Vim (<code>vi</code>). There’s really no competition for random Linux editing (even if you use Emacs, a big IDE, or a modern hipster editor most of the time).</p>
</li>
<li><p>Know ssh, and the basics of passwordless authentication, via <code>ssh-agent</code>, <code>ssh-add</code>, etc.</p>
</li>
<li><p>Be familiar with bash job management: <code>&amp;</code>, <strong>ctrl-z</strong>, <strong>ctrl-c</strong>, <code>jobs</code>, <code>fg</code>, <code>bg</code>, <code>kill</code>, etc.</p>
</li>
<li><p>Basic file management: <code>ls</code> and <code>ls -l</code> (in particular, learn what every column in <code>ls -l</code> means), <code>less</code>, <code>head</code>, <code>tail</code> and <code>tail -f</code>, <code>ln</code> and <code>ln -s</code> (learn the differences and advantages of hard versus soft links), <code>chown</code>, <code>chmod</code>, <code>du</code> (for a quick summary of disk usage: <code>du -sk *</code>), <code>df</code>, <code>mount</code>.</p>
</li>
<li><p>Basic network management: <code>ip</code> or <code>ifconfig</code>, <code>dig</code>.</p>
</li>
<li><p>Know regular expressions well, and the various flags to <code>grep</code>/<code>egrep</code>. The <code>-i</code>, <code>-o</code>, <code>-A</code>, and <code>-B</code> options are worth knowing.</p>
</li>
<li><p>Learn to use <code>apt-get</code> or <code>yum</code> (depending on distro) to find and install packages. And make sure you have <code>pip</code> to install Python-based command-line tools (a few below are easiest to install via <code>pip</code>).</p>
</li>
</ul>
<h2 id="Everyday-use"><a href="#Everyday-use" class="headerlink" title="Everyday use"></a>Everyday use</h2><ul>
<li><p>In bash, use <strong>ctrl-r</strong> to search through command history.</p>
</li>
<li><p>In bash, use <strong>ctrl-w</strong> to delete the last word, and <strong>ctrl-u</strong> to delete the whole line. Use <strong>alt-Left</strong> and <strong>alt-Right</strong> to move by word, and <strong>ctrl-k</strong> to kill to the end of the line. See <code>man readline</code> for all the default keybindings in bash. There are a lot. For example <strong>alt-.</strong> cycles through previous arguments, and *<em>alt-**</em> expands a glob.</p>
</li>
<li><p>To go back to the previous working directory: <code>cd -</code></p>
</li>
<li><p>If you are halfway through typing a command but change your mind, hit <strong>alt-#</strong> to add a <code>#</code> at the beginning and enter it as a comment (or use <strong>ctrl-a</strong>, <strong>#</strong>, <strong>enter</strong>). You can then return to it later via command history.</p>
</li>
<li><p>Use <code>xargs</code> (or <code>parallel</code>). It’s very powerful. Note you can control how many items execute per line (<code>-L</code>) as well as parallelism (<code>-P</code>). If you’re not sure if it’ll do the right thing, use <code>xargs echo</code> first. Also, <code>-I&#123;&#125;</code> is handy. Examples:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">find . -name \*.py | xargs grep some_function</span><br><span class="line">cat hosts | xargs -I&#123;&#125; ssh root@&#123;&#125; hostname</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>pstree -p</code> is a helpful display of the process tree.</p>
</li>
<li><p>Use <code>pgrep</code> and <code>pkill</code> to find or signal processes by name (<code>-f</code> is helpful).</p>
</li>
<li><p>Know the various signals you can send processes. For example, to suspend a process, use <code>kill -STOP [pid]</code>. For the full list, see <code>man 7 signal</code></p>
</li>
<li><p>Use <code>nohup</code> or <code>disown</code> if you want a background process to keep running forever.</p>
</li>
<li><p>Check what processes are listening via <code>netstat -lntp</code>.</p>
</li>
<li><p>See also <code>lsof</code> for open sockets and files.</p>
</li>
<li><p>In bash scripts, use <code>set -x</code> for debugging output. Use strict modes whenever possible. Use <code>set -e</code> to abort on errors. Use <code>set -o pipefail</code> as well, to be strict about errors (though this topic is a bit subtle). For more involved scripts, also use <code>trap</code>.</p>
</li>
<li><p>In bash scripts, subshells (written with parentheses) are convenient ways to group commands. A common example is to temporarily move to a different working directory, e.g.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># do something in current dir</span><br><span class="line">(cd &#x2F;some&#x2F;other&#x2F;dir; other-command)</span><br><span class="line"># continue in original dir</span><br></pre></td></tr></table></figure>
</li>
<li><p>In bash, note there are lots of kinds of variable expansion. Checking a variable exists: <code>$&#123;name:?error message&#125;</code>. For example, if a bash script requires a single argument, just write <code>input_file=$&#123;1:?usage: $0 input_file&#125;</code>. Arithmetic expansion: <code>i=$(( (i + 1) % 5 ))</code>. Sequences: <code>&#123;1..10&#125;</code>. Trimming of strings: <code>$&#123;var%suffix&#125;</code> and <code>$&#123;var#prefix&#125;</code>. For example if <code>var=foo.pdf</code>, then <code>echo $&#123;var%.pdf&#125;.txt</code> prints <code>foo.txt</code>.</p>
</li>
<li><p>The output of a command can be treated like a file via <code>&lt;(some command)</code>. For example, compare local <code>/etc/hosts</code> with a remote one:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">diff &#x2F;etc&#x2F;hosts &lt;(ssh somehost cat &#x2F;etc&#x2F;hosts)</span><br></pre></td></tr></table></figure>
</li>
<li><p>Know about “here documents” in bash, as in <code>cat &lt;&lt;EOF ...</code>.</p>
</li>
<li><p>In Bash, redirect both standard output and standard error via: <code>some-command &gt;logfile 2&gt;&amp;1</code>. Often, to ensure a command does not leave an open file handle to standard input, tying it to the terminal you are in, it is also good practice to add <code>&lt;/dev/null</code>.</p>
</li>
<li><p>Use <code>man ascii</code> for a good ASCII table, with hex and decimal values.</p>
</li>
<li><p>Use <code>screen</code> or <code>tmux</code> to multiplex the screen, especially useful on remote ssh sessions and to detach and re-attach to a session. A more minimal alternative for session persistence only is <code>dtach</code>.</p>
</li>
<li><p>In ssh, knowing how to port tunnel with <code>-L</code> or <code>-D</code> (and occasionally <code>-R</code>) is useful, e.g. to access web sites from a remote server.</p>
</li>
<li><p>It can be useful to make a few optimizations to your ssh configuration; for example, this <code>~/.ssh/config</code> contains settings to avoid dropped connections in certain network environments, and use compression (which is helpful with scp over low-bandwidth connections):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">TCPKeepAlive&#x3D;yes</span><br><span class="line">ServerAliveInterval&#x3D;15</span><br><span class="line">ServerAliveCountMax&#x3D;6</span><br><span class="line">Compression&#x3D;yes</span><br></pre></td></tr></table></figure>
</li>
<li><p>A few other options relevant to ssh are security sensitive and should be enabled with care, e.g. per subnet or host or in trusted networks: <code>StrictHostKeyChecking=no</code>, <code>ForwardAgent=yes</code></p>
</li>
<li><p>To get the permissions on a file in octal form, which is useful for system configuration but not available in <code>ls</code> and easy to bungle, use something like</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stat -c &#39;%A %a %n&#39; &#x2F;etc&#x2F;timezone</span><br></pre></td></tr></table></figure>
</li>
<li><p>For interactive selection of values from the output of another command, use <a target="_blank" rel="noopener" href="https://github.com/mooz/percol"><code>percol</code></a>.</p>
</li>
<li><p>For interaction with files based on the output of another command (like <code>git</code>), use <code>fpp</code> (<a target="_blank" rel="noopener" href="https://github.com/facebook/PathPicker">PathPicker</a>).</p>
</li>
</ul>
<h2 id="Processing-files-and-data"><a href="#Processing-files-and-data" class="headerlink" title="Processing files and data"></a>Processing files and data</h2><ul>
<li><p>To locate a file by name in the current directory, <code>find -iname *something* .</code> (or similar). To find a file anywhere by name, use <code>locate something</code> (but bear in mind <code>updatedb</code> my not have indexed recently created files).</p>
</li>
<li><p>For general searching through source or data files (more advanced than <code>grep -r</code>), use <a target="_blank" rel="noopener" href="https://github.com/ggreer/the_silver_searcher"><code>ag</code></a>.</p>
</li>
<li><p>To convert HTML to text: <code>lynx -dump -stdin</code></p>
</li>
<li><p>For Markdown, HTML, and all kinds of document conversion, try <a target="_blank" rel="noopener" href="http://pandoc.org/"><code>pandoc</code></a>.</p>
</li>
<li><p>If you must handle XML, <code>xmlstarlet</code> is old but good.</p>
</li>
<li><p>For JSON, use <code>jq</code>.</p>
</li>
<li><p>For Amazon S3, <a target="_blank" rel="noopener" href="https://github.com/s3tools/s3cmd"><code>s3cmd</code></a> is convenient and <a target="_blank" rel="noopener" href="https://github.com/bloomreach/s4cmd"><code>s4cmd</code></a> is faster. Amazon’s <a target="_blank" rel="noopener" href="https://github.com/aws/aws-cli"><code>aws</code></a> is essential for other AWS-related tasks.</p>
</li>
<li><p>Know about <code>sort</code> and <code>uniq</code>, including uniq’s <code>-u</code> and <code>-d</code> options – see one-liners below.</p>
</li>
<li><p>Know about <code>cut</code>, <code>paste</code>, and <code>join</code> to manipulate text files. Many people use <code>cut</code> but forget about <code>join</code>.</p>
</li>
<li><p>Know that locale affects a lot of command line tools in subtle ways, including sorting order (collation) and performance. Most Linux installations will set <code>LANG</code> or other locale variables to a local setting like US English. But be aware sorting will change if you change locale. And know i18n routines can make sort or other commands run <em>many times</em> slower. In some situations (such as the set operations or uniqueness operations below) you can safely ignore slow i18n routines entirely and use traditional byte-based sort order, using <code>export LC_ALL=C</code>.</p>
</li>
<li><p>Know basic <code>awk</code> and <code>sed</code> for simple data munging. For example, summing all numbers in the third column of a text file: <code>awk &#39;&#123; x += $3 &#125; END &#123; print x &#125;&#39;</code>. This is probably 3X faster and 3X shorter than equivalent Python.</p>
</li>
<li><p>To replace all occurrences of a string in place, in one or more files:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">perl -pi.bak -e &#39;s&#x2F;old-string&#x2F;new-string&#x2F;g&#39; my-files-*.txt</span><br></pre></td></tr></table></figure>
</li>
<li><p>To rename many files at once according to a pattern, use <code>rename</code>. For complex renames, <a target="_blank" rel="noopener" href="https://github.com/jlevy/repren"><code>repren</code></a> may help.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># Recover backup files foo.bak -&gt; foo:</span><br><span class="line">rename &#39;s&#x2F;\.bak$&#x2F;&#x2F;&#39; *.bak</span><br><span class="line"># Full rename of filenames, directories, and contents foo -&gt; bar:</span><br><span class="line">repren --full --preserve-case --from foo --to bar .</span><br></pre></td></tr></table></figure>
</li>
<li><p>Use <code>shuf</code> to shuffle or select random lines from a file.</p>
</li>
<li><p>Know <code>sort</code>‘s options. Know how keys work (<code>-t</code> and <code>-k</code>). In particular, watch out that you need to write <code>-k1,1</code> to sort by only the first field; <code>-k1</code> means sort according to the whole line.</p>
</li>
<li><p>Stable sort (<code>sort -s</code>) can be useful. For example, to sort first by field 2, then secondarily by field 1, you can use <code>sort -k1,1 | sort -s -k2,2</code></p>
</li>
<li><p>If you ever need to write a tab literal in a command line in bash (e.g. for the -t argument to sort), press <strong>ctrl-v</strong> <strong>[Tab]</strong> or write <code>$&#39;\t&#39;</code> (the latter is better as you can copy/paste it).</p>
</li>
<li><p>For binary files, use <code>hd</code> for simple hex dumps and <code>bvi</code> for binary editing.</p>
</li>
<li><p>Also for binary files, <code>strings</code> (plus <code>grep</code>, etc.) lets you find bits of text.</p>
</li>
<li><p>To convert text encodings, try <code>iconv</code>. Or <code>uconv</code> for more advanced use; it supports some advanced Unicode things. For example, this command lowercases and removes all accents (by expanding and dropping them):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uconv -f utf-8 -t utf-8 -x &#39;::Any-Lower; ::Any-NFD; [:Nonspacing Mark:] &gt;; ::Any-NFC; &#39; &lt; input.txt &gt; output.txt</span><br></pre></td></tr></table></figure>
</li>
<li><p>To split files into pieces, see <code>split</code> (to split by size) and <code>csplit</code> (to split by a pattern).</p>
</li>
</ul>
<h2 id="System-debugging"><a href="#System-debugging" class="headerlink" title="System debugging"></a>System debugging</h2><ul>
<li><p>For web debugging, <code>curl</code> and <code>curl -I</code> are handy, or their <code>wget</code> equivalents, or the more modern <a target="_blank" rel="noopener" href="https://github.com/jakubroztocil/httpie"><code>httpie</code></a>.</p>
</li>
<li><p>To know disk/cpu/network status, use <code>iostat</code>, <code>netstat</code>, <code>top</code> (or the better <code>htop</code>), and (especially) <code>dstat</code>. Good for getting a quick idea of what’s happening on a system.</p>
</li>
<li><p>For a more in-depth system overview, use <a target="_blank" rel="noopener" href="https://github.com/nicolargo/glances"><code>glances</code></a>. It presents you with several system level statistics in one terminal window. Very helpful for quickly checking on various subsystems.</p>
</li>
<li><p>To know memory status, run and understand the output of <code>free</code> and <code>vmstat</code>. In particular, be aware the “cached” value is memory held by the Linux kernel as file cache, so effectively counts toward the “free” value.</p>
</li>
<li><p>Java system debugging is a different kettle of fish, but a simple trick on Oracle’s and some other JVMs is that you can run <code>kill -3 &lt;pid&gt;</code> and a full stack trace and heap summary (including generational garbage collection details, which can be highly informative) will be dumped to stderr/logs.</p>
</li>
<li><p>Use <code>mtr</code> as a better traceroute, to identify network issues.</p>
</li>
<li><p>For looking at why a disk is full, <code>ncdu</code> saves time over the usual commands like <code>du -sh *</code>.</p>
</li>
<li><p>To find which socket or process is using bandwidth, try <code>iftop</code> or <code>nethogs</code>.</p>
</li>
<li><p>The <code>ab</code> tool (comes with Apache) is helpful for quick-and-dirty checking of web server performance. For more complex load testing, try <code>siege</code>.</p>
</li>
<li><p>For more serious network debugging, <code>wireshark</code> or <code>tshark</code>.</p>
</li>
<li><p>Know about <code>strace</code> and <code>ltrace</code>. These can be helpful if a program is failing, hanging, or crashing, and you don’t know why, or if you want to get a general idea of performance. Note the profiling option (<code>-c</code>), and the ability to attach to a running process (<code>-p</code>).</p>
</li>
<li><p>Know about <code>ldd</code> to check shared libraries etc.</p>
</li>
<li><p>Know how to connect to a running process with <code>gdb</code> and get its stack traces.</p>
</li>
<li><p>Use <code>/proc</code>. It’s amazingly helpful sometimes when debugging live problems. Examples: <code>/proc/cpuinfo</code>, <code>/proc/xxx/cwd</code>, <code>/proc/xxx/exe</code>, <code>/proc/xxx/fd/</code>, <code>/proc/xxx/smaps</code>.</p>
</li>
<li><p>When debugging why something went wrong in the past, <code>sar</code> can be very helpful. It shows historic statistics on CPU, memory, network, etc.</p>
</li>
<li><p>For deeper systems and performance analyses, look at <code>stap</code> (<a target="_blank" rel="noopener" href="https://sourceware.org/systemtap/wiki">SystemTap</a>), <a target="_blank" rel="noopener" href="http://en.wikipedia.org/wiki/Perf_(Linux)"><code>perf</code></a>, and <a target="_blank" rel="noopener" href="https://github.com/draios/sysdig"><code>sysdig</code></a>.</p>
</li>
<li><p>Confirm what Linux distribution you’re using (works on most distros): <code>lsb_release -a</code></p>
</li>
<li><p>Use <code>dmesg</code> whenever something’s acting really funny (it could be hardware or driver issues).</p>
</li>
</ul>
<h2 id="One-liners"><a href="#One-liners" class="headerlink" title="One-liners"></a>One-liners</h2><p>A few examples of piecing together commands:</p>
<ul>
<li><p>It is remarkably helpful sometimes that you can do set intersection, union, and difference of text files via <code>sort</code>/<code>uniq</code>. Suppose <code>a</code> and <code>b</code> are text files that are already uniqued. This is fast, and works on files of arbitrary size, up to many gigabytes. (Sort is not limited by memory, though you may need to use the <code>-T</code> option if <code>/tmp</code> is on a small root partition.) See also the note about <code>LC_ALL</code> above.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cat a b | sort | uniq &gt; c   # c is a union b</span><br><span class="line">cat a b | sort | uniq -d &gt; c   # c is a intersect b</span><br><span class="line">cat a b b | sort | uniq -u &gt; c   # c is set difference a - b</span><br></pre></td></tr></table></figure>
</li>
<li><p>Summing all numbers in the third column of a text file (this is probably 3X faster and 3X less code than equivalent Python):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk &#39;&#123; x +&#x3D; $3 &#125; END &#123; print x &#125;&#39; myfile</span><br></pre></td></tr></table></figure>
</li>
<li><p>If want to see sizes/dates on a tree of files, this is like a recursive <code>ls -l</code> but is easier to read than <code>ls -lR</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find . -type f -ls</span><br></pre></td></tr></table></figure>
</li>
<li><p>Use <code>xargs</code> or <code>parallel</code> whenever you can. Note you can control how many items execute per line (<code>-L</code>) as well as parallelism (<code>-P</code>). If you’re not sure if it’ll do the right thing, use xargs echo first. Also, <code>-I&#123;&#125;</code> is handy. Examples:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">find . -name \*.py | xargs grep some_function</span><br><span class="line">cat hosts | xargs -I&#123;&#125; ssh root@&#123;&#125; hostname</span><br></pre></td></tr></table></figure>
</li>
<li><p>Say you have a text file, like a web server log, and a certain value that appears on some lines, such as an <code>acct_id</code> parameter that is present in the URL. If you want a tally of how many requests for each <code>acct_id</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat access.log | egrep -o &#39;acct_id&#x3D;[0-9]+&#39; | cut -d&#x3D; -f2 | sort | uniq -c | sort -rn</span><br></pre></td></tr></table></figure>
</li>
<li><p>Run this function to get a random tip from this document (parses Markdown and extracts an item):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function taocl() &#123;</span><br><span class="line">  curl -s https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;jlevy&#x2F;the-art-of-command-line&#x2F;master&#x2F;README.md |</span><br><span class="line">    pandoc -f markdown -t html |</span><br><span class="line">    xmlstarlet fo --html --dropdtd |</span><br><span class="line">    xmlstarlet sel -t -v &quot;(html&#x2F;body&#x2F;ul&#x2F;li[count(p)&gt;0])[$RANDOM mod last()+1]&quot; |</span><br><span class="line">    xmlstarlet unesc | fmt 80</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


</li>
</ul>
<h2 id="Obscure-but-useful"><a href="#Obscure-but-useful" class="headerlink" title="Obscure but useful"></a>Obscure but useful</h2><ul>
<li><p><code>expr</code>: perform arithmetic or boolean operations or evaluate regular expressions</p>
</li>
<li><p><code>m4</code>: simple macro processor</p>
</li>
<li><p><code>screen</code>: powerful terminal multiplexing and session persistence</p>
</li>
<li><p><code>yes</code>: print a string a lot</p>
</li>
<li><p><code>cal</code>: nice calendar</p>
</li>
<li><p><code>env</code>: run a command (useful in scripts)</p>
</li>
<li><p><code>look</code>: find English words (or lines in a file) beginning with a string</p>
</li>
<li><p><code>cut </code>and paste and join: data manipulation</p>
</li>
<li><p><code>fmt</code>: format text paragraphs</p>
</li>
<li><p><code>pr</code>: format text into pages/columns</p>
</li>
<li><p><code>fold</code>: wrap lines of text</p>
</li>
<li><p><code>column</code>: format text into columns or tables</p>
</li>
<li><p><code>expand </code>and unexpand: convert between tabs and spaces</p>
</li>
<li><p><code>nl</code>: add line numbers</p>
</li>
<li><p><code>seq</code>: print numbers</p>
</li>
<li><p><code>bc</code>: calculator</p>
</li>
<li><p><code>factor</code>: factor integers</p>
</li>
<li><p><code>nc</code>: network debugging and data transfer</p>
</li>
<li><p><code>dd</code>: moving data between files or devices</p>
</li>
<li><p><code>file</code>: identify type of a file</p>
</li>
<li><p><code>stat</code>: file info</p>
</li>
<li><p><code>tac</code>: print files in reverse</p>
</li>
<li><p><code>shuf</code>: random selection of lines from a file</p>
</li>
<li><p><code>comm</code>: compare sorted files line by line</p>
</li>
<li><p><code>hd</code> and <code>bvi</code>: dump or edit binary files</p>
</li>
<li><p><code>strings</code>: extract text from binary files</p>
</li>
<li><p><code>tr</code>: character translation or manipulation</p>
</li>
<li><p><code>iconv </code>or uconv: conversion for text encodings</p>
</li>
<li><p><code>split </code>and csplit: splitting files</p>
</li>
<li><p><code>7z</code>: high-ratio file compression</p>
</li>
<li><p><code>ldd</code>: dynamic library info</p>
</li>
<li><p><code>nm</code>: symbols from object files</p>
</li>
<li><p><code>ab</code>: benchmarking web servers</p>
</li>
<li><p><code>strace</code>: system call debugging</p>
</li>
<li><p><code>mtr</code>: better traceroute for network debugging</p>
</li>
<li><p><code>cssh</code>: visual concurrent shell</p>
</li>
<li><p><code>wireshark</code> and <code>tshark</code>: packet capture and network debugging</p>
</li>
<li><p><code>host</code> and <code>dig</code>: DNS lookups</p>
</li>
<li><p><code>lsof</code>: process file descriptor and socket info</p>
</li>
<li><p><code>dstat</code>: useful system stats</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/nicolargo/glances"><code>glances</code></a> : high level, multi-subsystem overview</p>
</li>
<li><p><code>iostat</code>: CPU and disk usage stats</p>
</li>
<li><p><code>htop</code>: improved version of top</p>
</li>
<li><p><code>last</code>: login history</p>
</li>
<li><p><code>w</code>: who’s logged on</p>
</li>
<li><p><code>id</code>: user/group identity info</p>
</li>
<li><p><code>sar</code>: historic system stats</p>
</li>
<li><p><code>iftop</code> or <code>nethogs</code>: network utilization by socket or process</p>
</li>
<li><p><code>ss</code>: socket statistics</p>
</li>
<li><p><code>dmesg</code>: boot and system error messages</p>
</li>
<li><p><code>hdparm</code>: SATA/ATA disk manipulation/performance</p>
</li>
<li><p><code>lsb_release</code>: Linux distribution info</p>
</li>
<li><p><code>lshw</code>: hardware information</p>
</li>
<li><p><code>gpg</code>: encrypt and sign files</p>
</li>
<li><p><code>fortune</code>, <code>ddate</code>, and <code>sl</code>: um, well, it depends on whether you consider steam locomotives and Zippy quotations “useful”</p>
</li>
</ul>
<h2 id="More-resources"><a href="#More-resources" class="headerlink" title="More resources"></a>More resources</h2><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/alebcay/awesome-shell">awesome-shell</a>: A curated list of shell tools and resources.</li>
<li><a target="_blank" rel="noopener" href="http://redsymbol.net/articles/unofficial-bash-strict-mode/">Strict mode</a> for writing better shell scripts.</li>
</ul>
<h2 id="Disclaimer"><a href="#Disclaimer" class="headerlink" title="Disclaimer"></a>Disclaimer</h2><p>With the exception of very small tasks, code is written so others can read it. The fact you <em>can</em> do something in Bash doesn’t necessarily mean you should! ;)</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://jiajie999.github.io/2015/06/16/2015-06-16-cmd-notes/" data-id="ckdsi8gk5000oll9kanh98jki" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ash-cmd/" rel="tag">ash,cmd</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-2015-03-19-underscores-in-python" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/03/19/2015-03-19-underscores-in-python/" class="article-date">
  <time datetime="2015-03-19T14:06:53.000Z" itemprop="datePublished">2015-03-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/03/19/2015-03-19-underscores-in-python/">underscores in python</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>1 在解释器中用作显示上一条命令</p>
<p>2 在代码中用作一次性变量名</p>
<p>3 在I18N中用作标识需要国际化的字符串，django中<code>_()</code>是一个函数</p>
<pre><code>from django.utils.translation import ugettext as _
from django.http import HttpResponse

def my_view(request):
    output = _(&quot;Welcome to my site.&quot;)
    return HttpResponse(output)</code></pre>
<p>4 变量名前一个下划线用来标识私有变量，类内部使用</p>
<p>5 变量名前二个下划线用来处理继承中的变量名问题，python会自动给这类变量重命名</p>
<pre><code>&gt;&gt;&gt; class A(object):
...     def _internal_use(self):
...         pass
...     def __method_name(self):
...         pass
... 
&gt;&gt;&gt; dir(A())
[&#39;_A__method_name&#39;, ..., &#39;_internal_use&#39;]</code></pre>
<p>6 变量名前后都有下划线，python语言自用防止和用户定义变量名冲突。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://jiajie999.github.io/2015/03/19/2015-03-19-underscores-in-python/" data-id="ckdsi8gjh0006ll9kbexperf2" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python-underscores/" rel="tag">python,underscores</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-2015-02-07-flask-notes" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/02/07/2015-02-07-flask-notes/" class="article-date">
  <time datetime="2015-02-07T12:02:21.000Z" itemprop="datePublished">2015-02-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/02/07/2015-02-07-flask-notes/">Flask notes</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Notes for <a target="_blank" rel="noopener" href="http://www.syncano.com/advanced-concepts-flask/">Advanced Concepts in Flask</a></p>
<p>There are two closely related notions when it comes to scaling – how the application is affected with an increase in users and how it is affected with an increase in programmers writing it.</p>
<p>The central questions: How do we work effectively in teams of 20 developers, 40 developers, or even thousands? And how do we handle maximum load on our system?</p>
<ol>
<li><p>几条原则，感觉不光适用于flask，写别的东西也一样，不过最后三条不容易做到啊</p>
<ul>
<li><p>Modularity of functionality</p>
</li>
<li><p>Loosely coupled code is better than tightly coupled (usually)</p>
</li>
<li><p>Comment often</p>
</li>
<li><p>Reuse code as often as possible</p>
</li>
<li><p>Write code that is as general as possible</p>
</li>
<li><p>Test as often as possible, both at the module level and the system level</p>
</li>
<li><p>Give yourself enough time to get things done and then stay within budget</p>
</li>
<li><p>Collaboration is extremely important – pair program and have solid metrics about your code</p>
</li>
</ul>
</li>
<li><p>Blue print来划分各个app，放便日后升级、改动、排错</p>
</li>
<li><p>Contexts的正确使用（没太看懂为啥重要，貌似框架本身已经把细节藏的很深了。。。有待进一步学习）</p>
<ul>
<li><p>理解flask里面的contexts以参考这篇<a target="_blank" rel="noopener" href="http://kronosapiens.github.io/blog/2014/08/14/understanding-contexts-in-flask/">文章</a></p>
<blockquote>
<p>“contexts are used to control the presence or absence of various global variables, so that you, the developer, can simply assume that the correct variables will be available when you need them. Given that an application can be running in multiple threads and serving multiple clients at once…”    </p>
</blockquote>
<blockquote>
<p>From Miguel Grinberg’s Flask Web Development (p12):</p>
</blockquote>
<blockquote>
<p>When Flask receives a request from a client, it needs to make a few objects available to the view functions that will handle it. A good example of this is the request object, which encapsulates the HTTP request sent by the client.</p>
</blockquote>
<blockquote>
<p>The obvious way in which Flask could give a view function access to the request object is by sending it as an argument, but that would require every single view function in the application to have an extra argument. …</p>
</blockquote>
<blockquote>
<p>To avoid cluttering view functions with lots of arguments that may or may not be neded, Flask uses contexts to temporarily make certain objects globally accessible.</p>
</blockquote>
</li>
</ul>
<p>粗浅的理解就是context用来管理flask中的全局变量，每个请求进来后可以访问这类变量中的资源，例如数据库链接，并且这种访问是线程安全的。</p>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://jiajie999.github.io/2015/02/07/2015-02-07-flask-notes/" data-id="ckdsi8gjd0003ll9kes8a2d95" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/flask/" rel="tag">flask</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-concurrency-is-not-parallelism" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/10/08/concurrency-is-not-parallelism/" class="article-date">
  <time datetime="2014-10-08T14:06:53.000Z" itemprop="datePublished">2014-10-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/10/08/concurrency-is-not-parallelism/">Concurrency is not Parallelism</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>##并发 vs. 并行</p>
<p>并发是指同时处理很多事情。</p>
<p>而并行是指同时能完成很多事情。</p>
<p>两者不同，但相关。</p>
<p>一个重点是组合，一个重点是执行。</p>
<p>并发提供了一种方式让我们能够设计一种方案将问题(非必须的)并行的解决。</p>
<p>地鼠的例子<a target="_blank" rel="noopener" href="http://www.vaikan.com/docs/Concurrency-is-not-Parallelism">源ppt地址</a></p>
<p><strong>习得</strong></p>
<p>有很多分解流程的方式。</p>
<p>这都是并发设计。</p>
<p>一旦完成了分解，并行可能会丧失，但很容易纠正。</p>
<p>##并发是并行成为可能</p>
<p>这个负载均衡的例子具有很明显的并行和可扩展性。</p>
<p>Worker数可以非常巨大。</p>
<p>Go语言的这种并发特征能的开发一个安全的、好用的、可扩展的、并行的软件变得很容易</p>
<p>##并发简化了同步</p>
<p>没有明显的需要同步的操作。</p>
<p>程序的这种设计隐含的实现了同步。</p>
<p>##结论</p>
<p>并发很强大。</p>
<p>并发不是并行。</p>
<p>并发帮助实现并行。</p>
<p>并发使并行(扩展等)变得容易。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://jiajie999.github.io/2014/10/08/concurrency-is-not-parallelism/" data-id="ckdsi8gjv000cll9k06txfo6z" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/concurrency/" rel="tag">concurrency</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-2014-12-26-use-python-3rd-party-lib" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/09/09/2014-12-26-use-python-3rd-party-lib/" class="article-date">
  <time datetime="2014-09-09T14:06:53.000Z" itemprop="datePublished">2014-09-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/09/09/2014-12-26-use-python-3rd-party-lib/">Some interesting python libs</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><a target="_blank" rel="noopener" href="http://multithreaded.stitchfix.com/blog/2015/07/16/pyxley/">pyxley生成交互式的可视化数据</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/lorien/user_agent">生成随机user-agent</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/themiurgo/ratelim">Rate limit your api call</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/emirozer/fake2db">Fake data in database</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/joke2k/faker">There is another lib which just generates fake data</a></p>
<p>在项目里用过，很好用，现在也支持输出多国语言的数据</p>
<p><a target="_blank" rel="noopener" href="https://github.com/mobify/iterstuff">Useful tools for working with iterators</a></p>
<p>暂时用不到，标准库里的iterator tools已经很强大了</p>
<p><a target="_blank" rel="noopener" href="https://github.com/benjamin-croker/loggy">log function call</a></p>
<p>之前有过操作日志的需求自己写了一个，同时往文件和mongo里存log。有了这个就不用自己重复造轮子了</p>
<p><a target="_blank" rel="noopener" href="https://github.com/rdegges/brute">brute</a></p>
<p>方便生成字符全排列,想学iterator tools用法的可以看看这个包。</p>
<p><a target="_blank" rel="noopener" href="https://github.com/sloria/doitlive">doitlive</a></p>
<p>强烈推荐！非常酷的命令行演示工具大幅度提升逼格</p>
<p><a target="_blank" rel="noopener" href="https://github.com/avelino/mining">Business Intelligence (BI) in Python (Pandas web interface)</a></p>
<p>pandas的web界面版</p>
<p><a target="_blank" rel="noopener" href="http://amoffat.github.com/sh">sh</a></p>
<p>在python中直接import shell命令</p>
<p><a target="_blank" rel="noopener" href="http://delorean.readthedocs.org/en/latest/">delorean</a></p>
<p>处理时间相关功能的好东西</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://jiajie999.github.io/2014/09/09/2014-12-26-use-python-3rd-party-lib/" data-id="ckdsi8gj70001ll9k2dab1pvj" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/" rel="tag">python</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-ChangeSRCforRuby" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/08/19/ChangeSRCforRuby/" class="article-date">
  <time datetime="2014-08-19T14:06:53.000Z" itemprop="datePublished">2014-08-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/08/19/ChangeSRCforRuby/">Change your gem source if your living in china...</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>感谢taobao提供这个源，FUC××××××WALL！！！ <a target="_blank" rel="noopener" href="https://ruby.taobao.org/">taobao源地址</a></p>
<pre><code>$ gem sources --remove https://rubygems.org/
$ gem sources -a https://ruby.taobao.org/
$ gem sources -l
*** CURRENT SOURCES ***

https://ruby.taobao.org
# 请确保只有 ruby.taobao.org
$ gem install rails</code></pre>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://jiajie999.github.io/2014/08/19/ChangeSRCforRuby/" data-id="ckdsi8gjm0008ll9k59r8c6wp" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/closures-python/" rel="tag">closures,python</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-closures-in-python" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/08/14/closures-in-python/" class="article-date">
  <time datetime="2014-08-14T14:06:53.000Z" itemprop="datePublished">2014-08-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/08/14/closures-in-python/">Python的闭包</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><a target="_blank" rel="noopener" href="http://stackoverflow.com/questions/4020419/closures-in-python">SO上关于Python闭包问题的最佳答案</a></p>
<p>A closure occurs when a function has access to a local variable from an enclosing scope that has finished its execution.</p>
<pre><code>def make_printer(msg):
    def printer():
        print msg
    return printer

printer = make_printer(&#39;Foo!&#39;)
printer()</code></pre>
<p>When make_printer is called, a new frame is put on the stack with the compiled code for the printer function as a constant and the value of msg as a local. It then creates and returns the function. Because the function printer references the msg variable, it is kept alive after the make_printer function has returned.</p>
<p>So, if your nested functions don’t</p>
<p>access variables that are local to enclosing scopes,<br>do so when they are executed outside of that scope,<br>then they are not closures.</p>
<p>Here’s an example of a nested function which is not a closure.</p>
<pre><code>def make_printer(msg):
    def printer(msg=msg):
        print msg
    return printer

printer = make_printer(&quot;Foo!&quot;)
printer()  #Output: Foo!</code></pre>
<p>Here, we are binding the value to the default value of a parameter. This occurs when the function printer is created and so no reference to the value of msg external to printer needs to be maintained after make_printer returns. msg is just a normal local variable of the function printer in this context.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://jiajie999.github.io/2014/08/14/closures-in-python/" data-id="ckdsi8gjs0009ll9khr6shibb" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/closures-python/" rel="tag">closures,python</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-tukumx-is-better-than-mongo" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/07/15/tukumx-is-better-than-mongo/" class="article-date">
  <time datetime="2014-07-15T12:06:53.000Z" itemprop="datePublished">2014-07-15</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/mongo/">mongo</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/07/15/tukumx-is-better-than-mongo/">TukuMX is better than mongo?</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>今天在网上看到一个TukuMX的开源项目，算是mongodb的一个分支项目。也是由一家商业公司开源出来，并同时提供商业版本，记录一些点备查。</p>
<p>###亮点：</p>
<ul>
<li>压缩。MongoDB BSON格式的带来的存储空间消耗实在是太大了，使用TokuMX 默认的zlib压缩可以减少大量的磁盘空间占用（1/3-1/20）。</li>
<li>更好的存储空间利用效率。MongoDB 空间释放是个麻烦的事情（需要drop 整个个数据库或者repair），TokuMX drop collect或者index即可释放空间。</li>
<li>更好的内存管理。MongoDB nmap简单，但是不方便分配固定内存。caching和 IO都交由操作系统去调度，时间长了，数据大了容易造成内存泄露。TokuMX 通过参数指定cacheSize分配固定大小的内存（多实例环境这个非常适用，虽然不推荐使用多实例）。</li>
<li>写优化。这个是TokuMX 最基础最根本的东西，在大数据量的情况下写入速度基本保持不变。MongoDB在超过1亿记录后或在数据比较大的情况下，写性能衰减得比较厉害，这一切归因于40年的B-tree索引，也正是TokuMX 分形树索引优化的地方。</li>
<li>其他的特性，如document 级别的锁，事务支持等，这些不是我们所重的，实际效果还需时间检验。</li>
</ul>
<p>###不足：</p>
<ul>
<li>不支持，如geo索引，全文索引。</li>
</ul>
<p>###<a target="_blank" rel="noopener" href="http://www.luanxiang.org/blog/archives/1760.html">TokuMX的分形索引是什么？</a><br>这篇文章讲了tukumx的索引算法，一种改进版B-tree</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://jiajie999.github.io/2014/07/15/tukumx-is-better-than-mongo/" data-id="ckdsi8gk4000nll9kaoc07n86" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mongo/" rel="tag">mongo</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nosql/" rel="tag">nosql</a></li></ul>

    </footer>
  </div>
  
</article>


  


</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/mongo/">mongo</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/ash-cmd/" rel="tag">ash,cmd</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/closures-python/" rel="tag">closures,python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/concurrency/" rel="tag">concurrency</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/flask/" rel="tag">flask</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mongo/" rel="tag">mongo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nosql/" rel="tag">nosql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/" rel="tag">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python-underscores/" rel="tag">python,underscores</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/ash-cmd/" style="font-size: 10px;">ash,cmd</a> <a href="/tags/closures-python/" style="font-size: 20px;">closures,python</a> <a href="/tags/concurrency/" style="font-size: 10px;">concurrency</a> <a href="/tags/flask/" style="font-size: 10px;">flask</a> <a href="/tags/mongo/" style="font-size: 10px;">mongo</a> <a href="/tags/nosql/" style="font-size: 10px;">nosql</a> <a href="/tags/python/" style="font-size: 10px;">python</a> <a href="/tags/python-underscores/" style="font-size: 10px;">python,underscores</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/06/">June 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/03/">March 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/02/">February 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/10/">October 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/09/">September 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/08/">August 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/07/">July 2014</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/08/13/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2015/06/16/2015-06-16-cmd-notes/">The Art of Command Line[转]</a>
          </li>
        
          <li>
            <a href="/2015/03/19/2015-03-19-underscores-in-python/">underscores in python</a>
          </li>
        
          <li>
            <a href="/2015/02/07/2015-02-07-flask-notes/">Flask notes</a>
          </li>
        
          <li>
            <a href="/2014/10/08/concurrency-is-not-parallelism/">Concurrency is not Parallelism</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 Jie.Jia<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>